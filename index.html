<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Dashboard - Tijerina Legal Group PC</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #f9fafb;
        }
        #loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 24px;
            color: #2563eb;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            color: #dc2626;
            padding: 20px;
            max-width: 600px;
            margin: 20px auto;
            background: #fee2e2;
            border-radius: 8px;
            border: 1px solid #dc2626;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <div>Loading Dashboard...</div>
        <div style="font-size: 14px; color: #6b7280; margin-top: 10px;">This may take a few seconds</div>
    </div>
    <div id="error" style="display: none;"></div>
    <div id="root"></div>

    <!-- Load libraries in correct order -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>

    <script type="text/babel">
        // Check if libraries loaded
        function checkLibraries() {
            const missing = [];
            if (typeof React === 'undefined') missing.push('React');
            if (typeof ReactDOM === 'undefined') missing.push('ReactDOM');
            if (typeof Recharts === 'undefined') missing.push('Recharts');
            
            if (missing.length > 0) {
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <div class="error">
                        <h2>Error Loading Dashboard</h2>
                        <p>The following libraries failed to load: ${missing.join(', ')}</p>
                        <p>Please check your internet connection and refresh the page.</p>
                        <button onclick="location.reload()" style="background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            Retry
                        </button>
                    </div>
                `;
                return false;
            }
            return true;
        }

        // Wait for everything to load
        setTimeout(() => {
            if (!checkLibraries()) return;

            try {
                const { useState } = React;
                const { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell } = Recharts;

                // Sample Data
                const ticketData = {
                    bySeverity: [
                        { severity: 'P0', count: 0, target: 0 },
                        { severity: 'P1', count: 1, target: 3 },
                        { severity: 'P2', count: 4, target: 10 },
                        { severity: 'P3', count: 12, target: 30 },
                        { severity: 'P4', count: 8, target: 20 }
                    ],
                    topIssues: [
                        { issue: 'VPN Connection Timeouts', count: 18, priority: 'High', owner: 'Network Team', target: '11/03' },
                        { issue: 'Salesforce Slow Performance', count: 15, priority: 'High', owner: 'SF Admin', target: '11/10' },
                        { issue: 'Outlook Calendar Sync', count: 12, priority: 'Medium', owner: 'Email Admin', target: '11/05' },
                        { issue: '3rd Floor Printer', count: 9, priority: 'Medium', owner: 'Help Desk', target: '10/30' },
                        { issue: 'Password Resets', count: 8, priority: 'Low', owner: 'Help Desk', target: '11/05' }
                    ],
                    teamWorkload: [
                        { name: 'Tech A', tickets: 5 },
                        { name: 'Tech B', tickets: 8 },
                        { name: 'Tech C', tickets: 2 },
                        { name: 'Sr Admin', tickets: 5 },
                        { name: 'Sys Admin', tickets: 3 },
                        { name: 'Net Admin', tickets: 2 }
                    ]
                };

                const executiveData = {
                    uptime: [
                        { system: 'Salesforce', uptime: 99.9 },
                        { system: 'Email', uptime: 99.8 },
                        { system: 'File Servers', uptime: 99.5 },
                        { system: 'Network', uptime: 99.6 },
                        { system: 'Overall', uptime: 99.7 }
                    ],
                    trends: [
                        { month: 'Aug', tickets: 145, satisfaction: 4.2, resolution: 21 },
                        { month: 'Sep', tickets: 152, satisfaction: 4.3, resolution: 19 },
                        { month: 'Oct', tickets: 138, satisfaction: 4.5, resolution: 18.5 }
                    ],
                    projects: [
                        { name: 'Business Continuity Enhancement', progress: 75, status: 'On Track' },
                        { name: 'Salesforce Performance Optimization', progress: 50, status: 'In Progress' },
                        { name: 'Security Awareness Training', progress: 60, status: 'On Track' }
                    ]
                };

                const spreadsheetData = [
                    { metric: 'Open P0', value: 0, target: 0, formula: 'Manual entry', status: '✅' },
                    { metric: 'Open P1', value: 1, target: '<3', formula: 'Manual entry', status: '✅' },
                    { metric: 'Total Open', value: 25, target: '<50', formula: '=SUM(P0:P4)', status: '✅' },
                    { metric: 'First Response SLA %', value: '97.8%', target: '>95%', formula: '=COUNTIF(MetSLA,"Y")/COUNT(Tickets)*100', status: '✅' },
                    { metric: 'Resolution SLA %', value: '94.2%', target: '>90%', formula: '=COUNTIF(Resolved,"Y")/COUNT(Tickets)*100', status: '✅' },
                    { metric: 'Avg Response (min)', value: 42, target: '<60', formula: '=AVERAGE(ResponseTimes)', status: '✅' },
                    { metric: 'Salesforce Uptime', value: '99.9%', target: '>99.5%', formula: '=(Total_Min-Down_Min)/Total_Min*100', status: '✅' },
                    { metric: 'Overall Uptime', value: '99.7%', target: '>99.5%', formula: '=AVERAGE(System_Uptimes)', status: '✅' },
                    { metric: 'User Satisfaction', value: '4.5/5', target: '>4.0', formula: '=AVERAGE(Survey_Scores)', status: '✅' },
                    { metric: 'Budget Used %', value: '72%', target: '<85%', formula: '=YTD_Spend/Annual_Budget*100', status: '✅' }
                ];

                const Dashboard = () => {
                    const [activeView, setActiveView] = useState('ops');

                    const ProgressBar = ({ value, color = "blue" }) => {
                        const colorClass = color === 'green' ? 'bg-green-600' : color === 'blue' ? 'bg-blue-600' : 'bg-purple-600';
                        return (
                            <div className="w-full bg-gray-200 rounded-full h-2.5">
                                <div className={`${colorClass} h-2.5 rounded-full transition-all duration-500`} style={{ width: `${value}%` }} />
                            </div>
                        );
                    };

                    return (
                        <div className="min-h-screen bg-gray-50">
                            {/* Header */}
                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 shadow-lg">
                                <div className="max-w-7xl mx-auto">
                                    <h1 className="text-3xl font-bold mb-2">Tijerina Legal Group PC - IT Dashboard</h1>
                                    <p className="text-blue-100">IT Director Test Assignment | Interactive Dashboard Demo</p>
                                </div>
                            </div>

                            {/* Navigation */}
                            <div className="bg-white shadow-sm border-b">
                                <div className="max-w-7xl mx-auto px-6">
                                    <div className="flex gap-4">
                                        <button onClick={() => setActiveView('ops')} className={`px-6 py-4 font-semibold border-b-2 transition-colors ${activeView === 'ops' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-600 hover:text-gray-900'}`}>
                                            📊 IT Operations
                                        </button>
                                        <button onClick={() => setActiveView('exec')} className={`px-6 py-4 font-semibold border-b-2 transition-colors ${activeView === 'exec' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-600 hover:text-gray-900'}`}>
                                            🖥️ Executive Snapshot
                                        </button>
                                        <button onClick={() => setActiveView('data')} className={`px-6 py-4 font-semibold border-b-2 transition-colors ${activeView === 'data' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-600 hover:text-gray-900'}`}>
                                            📋 Data & Formulas
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Content */}
                            <div className="max-w-7xl mx-auto p-6">
                                {activeView === 'ops' && (
                                    <div className="space-y-6">
                                        {/* Tickets by Severity */}
                                        <div className="bg-white p-6 rounded-lg shadow-md">
                                            <h2 className="text-xl font-bold mb-4">⚠️ Open Tickets by Severity</h2>
                                            <div className="grid grid-cols-6 gap-4">
                                                {ticketData.bySeverity.map((item) => (
                                                    <div key={item.severity} className="text-center">
                                                        <div className="text-sm text-gray-600 mb-2">{item.severity}</div>
                                                        <div className="text-4xl font-bold text-gray-900 mb-1">{item.count}</div>
                                                        <div className="text-xs text-gray-500">Target: {item.target}</div>
                                                        <div className="mt-2"><span className="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">✅</span></div>
                                                    </div>
                                                ))}
                                                <div className="text-center border-l-2 border-gray-200 pl-4">
                                                    <div className="text-sm text-gray-600 mb-2">TOTAL</div>
                                                    <div className="text-4xl font-bold text-blue-600 mb-1">25</div>
                                                    <div className="text-xs text-gray-500">Target: &lt;50</div>
                                                    <div className="mt-2"><span className="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">✅</span></div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* SLA & Charts */}
                                        <div className="grid grid-cols-2 gap-6">
                                            <div className="bg-white p-6 rounded-lg shadow-md">
                                                <h2 className="text-xl font-bold mb-4">⏰ SLA Performance</h2>
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="flex justify-between mb-2">
                                                            <span className="font-semibold">First Response SLA</span>
                                                            <span className="text-2xl font-bold text-green-600">97.8%</span>
                                                        </div>
                                                        <ProgressBar value={97.8} color="green" />
                                                        <div className="grid grid-cols-3 gap-2 mt-2 text-sm text-center">
                                                            <div><div className="text-gray-600">P0/P1</div><div className="font-semibold">100%</div></div>
                                                            <div><div className="text-gray-600">P2</div><div className="font-semibold">98%</div></div>
                                                            <div><div className="text-gray-600">P3/P4</div><div className="font-semibold">96%</div></div>
                                                        </div>
                                                    </div>
                                                    <div className="border-t pt-4">
                                                        <div className="flex justify-between mb-2">
                                                            <span className="font-semibold">Resolution SLA</span>
                                                            <span className="text-2xl font-bold text-blue-600">94.2%</span>
                                                        </div>
                                                        <ProgressBar value={94.2} color="blue" />
                                                        <div className="grid grid-cols-3 gap-2 mt-2 text-sm text-center">
                                                            <div><div className="text-gray-600">P0/P1</div><div className="font-semibold">100%</div></div>
                                                            <div><div className="text-gray-600">P2</div><div className="font-semibold">92%</div></div>
                                                            <div><div className="text-gray-600">P3/P4</div><div className="font-semibold">92%</div></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="bg-white p-6 rounded-lg shadow-md">
                                                <h2 className="text-xl font-bold mb-4">👥 Team Workload</h2>
                                                <ResponsiveContainer width="100%" height={250}>
                                                    <BarChart data={ticketData.teamWorkload}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="name" angle={-45} textAnchor="end" height={80} />
                                                        <YAxis />
                                                        <Tooltip />
                                                        <Bar dataKey="tickets" fill="#8b5cf6" />
                                                    </BarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>

                                        {/* Top Issues */}
                                        <div className="bg-white p-6 rounded-lg shadow-md">
                                            <h2 className="text-xl font-bold mb-4">🔥 Top 5 Recurring Issues</h2>
                                            <div className="space-y-3">
                                                {ticketData.topIssues.map((issue, idx) => (
                                                    <div key={idx} className="border-l-4 border-blue-500 pl-4 py-3 bg-gray-50 rounded flex justify-between items-center">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-2xl font-bold text-gray-400">{idx + 1}</span>
                                                            <div>
                                                                <div className="font-semibold">{issue.issue}</div>
                                                                <div className="text-sm text-gray-600">Owner: {issue.owner} | Target: {issue.target}</div>
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className="text-right">
                                                                <div className="text-2xl font-bold text-red-600">{issue.count}</div>
                                                                <div className="text-xs text-gray-500">tickets</div>
                                                            </div>
                                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${issue.priority === 'High' ? 'bg-red-100 text-red-800' : issue.priority === 'Medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}`}>
                                                                {issue.priority}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeView === 'exec' && (
                                    <div className="space-y-6">
                                        {/* System Health */}
                                        <div className="bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-lg shadow-md border-l-4 border-green-500">
                                            <h2 className="text-2xl font-bold mb-4">✅ Overall IT Status: HEALTHY</h2>
                                            <p className="text-green-700 mb-4">All systems operating normally - 99.7% uptime</p>
                                            <div className="grid grid-cols-5 gap-4">
                                                {executiveData.uptime.map((sys) => (
                                                    <div key={sys.system} className="bg-white p-4 rounded-lg shadow-sm">
                                                        <div className="text-sm text-gray-600">{sys.system}</div>
                                                        <div className="text-2xl font-bold text-green-600">{sys.uptime}%</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Charts */}
                                        <div className="grid grid-cols-2 gap-6">
                                            <div className="bg-white p-6 rounded-lg shadow-md">
                                                <h2 className="text-xl font-bold mb-4">📈 Service Quality Trends</h2>
                                                <ResponsiveContainer width="100%" height={250}>
                                                    <LineChart data={executiveData.trends}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="month" />
                                                        <YAxis yAxisId="left" />
                                                        <YAxis yAxisId="right" orientation="right" />
                                                        <Tooltip />
                                                        <Legend />
                                                        <Line yAxisId="left" type="monotone" dataKey="tickets" stroke="#3b82f6" strokeWidth={2} name="Tickets" />
                                                        <Line yAxisId="right" type="monotone" dataKey="satisfaction" stroke="#10b981" strokeWidth={2} name="Satisfaction" />
                                                    </LineChart>
                                                </ResponsiveContainer>
                                                <div className="mt-3 text-sm text-center text-gray-600">✅ Tickets down 9% | Satisfaction up 7%</div>
                                            </div>

                                            <div className="bg-white p-6 rounded-lg shadow-md">
                                                <h2 className="text-xl font-bold mb-4">⏱️ Resolution Time Trend</h2>
                                                <ResponsiveContainer width="100%" height={250}>
                                                    <BarChart data={executiveData.trends}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="month" />
                                                        <YAxis />
                                                        <Tooltip />
                                                        <Bar dataKey="resolution" fill="#8b5cf6" name="Avg Resolution (hrs)" />
                                                    </BarChart>
                                                </ResponsiveContainer>
                                                <div className="mt-3 text-sm text-center text-gray-600">✅ Improved 12% over 90 days</div>
                                            </div>
                                        </div>

                                        {/* Projects */}
                                        <div className="bg-white p-6 rounded-lg shadow-md">
                                            <h2 className="text-xl font-bold mb-4">📅 Current Projects</h2>
                                            <div className="space-y-4">
                                                {executiveData.projects.map((proj, idx) => (
                                                    <div key={idx} className="border-l-4 border-blue-500 pl-4 py-3 bg-gray-50 rounded">
                                                        <div className="flex justify-between mb-2">
                                                            <div className="font-semibold">{proj.name}</div>
                                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${proj.status === 'On Track' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}`}>{proj.status}</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className="flex-1"><ProgressBar value={proj.progress} color={proj.status === 'On Track' ? 'green' : 'blue'} /></div>
                                                            <div className="text-sm font-semibold">{proj.progress}%</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Risk */}
                                        <div className="bg-white p-6 rounded-lg shadow-md">
                                            <h2 className="text-xl font-bold mb-4">⚠️ Risks & Decisions</h2>
                                            <div className="space-y-4">
                                                <div className="border-l-4 border-red-500 pl-4 py-3 bg-red-50 rounded">
                                                    <div className="font-semibold text-red-600">🔴 HIGH PRIORITY</div>
                                                    <div className="mt-2 text-sm">
                                                        <div className="font-semibold">VPN Connection Reliability</div>
                                                        <div className="text-gray-700">18 incidents. Hardware at 92% capacity.</div>
                                                        <div className="mt-1"><strong>Decision needed by:</strong> November 3</div>
                                                    </div>
                                                </div>
                                                <div className="border-l-4 border-yellow-500 pl-4 py-3 bg-yellow-50 rounded">
                                                    <div className="font-semibold text-yellow-600">⚠️ MEDIUM PRIORITY</div>
                                                    <div className="mt-2 text-sm">
                                                        <div className="font-semibold">Office 365 Renewal</div>
                                                        <div className="text-gray-700">Due Dec 15. 3-year option saves $6,480.</div>
                                                        <div className="mt-1"><strong>Decision needed by:</strong> November 15</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeView === 'data' && (
                                    <div className="bg-white p-6 rounded-lg shadow-md">
                                        <h2 className="text-xl font-bold mb-4">📋 Dashboard Data & Formulas</h2>
                                        <p className="text-gray-600 mb-6">Excel/Google Sheets formulas used to calculate dashboard metrics</p>
                                        <div className="overflow-x-auto">
                                            <table className="w-full border-collapse">
                                                <thead>
                                                    <tr className="bg-blue-600 text-white">
                                                        <th className="border border-gray-300 px-4 py-3 text-left">Metric</th>
                                                        <th className="border border-gray-300 px-4 py-3 text-left">Value</th>
                                                        <th className="border border-gray-300 px-4 py-3 text-left">Target</th>
                                                        <th className="border border-gray-300 px-4 py-3 text-left">Excel Formula</th>
                                                        <th className="border border-gray-300 px-4 py-3 text-center">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {spreadsheetData.map((row, idx) => (
                                                        <tr key={idx} className={idx % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                                            <td className="border border-gray-300 px-4 py-3 font-medium">{row.metric}</td>
                                                            <td className="border border-gray-300 px-4 py-3 text-center font-semibold text-blue-600">{row.value}</td>
                                                            <td className="border border-gray-300 px-4 py-3 text-center">{row.target}</td>
                                                            <td className="border border-gray-300 px-4 py-3 font-mono text-sm bg-gray-100">{row.formula}</td>
                                                            <td className="border border-gray-300 px-4 py-3 text-center text-xl">{row.status}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div className="mt-6 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                            <h3 className="font-bold mb-2">Implementation Notes</h3>
                                            <ul className="text-sm space-y-1">
                                                <li>✅ All formulas production-ready and tested</li>
                                                <li>✅ Compatible with Excel, Google Sheets, and BI tools</li>
                                                <li>✅ Can be automated via ticketing system API</li>
                                                <li>✅ Formulas update automatically with new data</li>
                                            </ul>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Footer */}
                            <div className="bg-gray-800 text-white py-6 mt-12">
                                <div className="max-w-7xl mx-auto px-6 text-center">
                                    <p className="text-gray-400">IT Director Test Assignment - Tijerina Legal Group PC</p>
                                    <p className="text-gray-500 text-sm mt-2">Interactive Dashboard | Sample Data for Demonstration</p>
                                </div>
                            </div>
                        </div>
                    );
                };

                // Hide loading and render
                document.getElementById('loading').style.display = 'none';
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<Dashboard />);

            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <div class="error">
                        <h2>Error Loading Dashboard</h2>
                        <p>An error occurred: ${error.message}</p>
                        <p>Please refresh the page or check the browser console for details.</p>
                        <button onclick="location.reload()" style="background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            Retry
                        </button>
                    </div>
                `;
                console.error('Dashboard error:', error);
            }
        }, 1000);
    </script>
</body>
</html>
